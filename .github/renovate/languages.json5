{
    "$schema": "https://docs.renovatebot.com/renovate-schema.json",
    "gomod": {
        "postUpdateOptions": [
            "gomodTidy",
            "gomodUpdateImportPaths"
        ]
    },
    "customManagers": [
        // Earthfiles
        {
            "description": "Earthly language version - Earthfiles",
            "customType": "regex",
            "fileMatch": [
                "Earthfile$"
            ],
            "matchStrings": [
                "^\\s*VERSION(?:.*(?:\\\\\\n)?)*(?<currentValue>\\d+\\.\\d)+$"
            ],
            "datasourceTemplate": "github-releases",
            "depNameTemplate": "earthly/earthly",
            "packageNameTemplate": "earthly/earthly",
            "versioningTemplate": "semver-coerced",
            // Extract the major and minor version from the latest GH release
            "extractVersionTemplate": "^v?(?<version>\\d+\\.\\d+).*$"
        },
        {
            "description": "Earthly version - setup action in GHA workflows",
            "customType": "regex",
            "fileMatch": [
                "^.*/workflows/[^/].ya?ml$"
            ],
            "matchStrings": [
                "# renovate: earthly-version\\s*\\n\\s*version: \\s*(?<currentValue>.*?)\\s*\\n"
            ],
            "datasourceTemplate": "github-releases",
            "depNameTemplate": "earthly/earthly",
            "packageNameTemplate": "earthly/earthly",
            "versioningTemplate": "semver-coerced"
        },
        {
            "description": "Container images - Earthfiles",
            "customType": "regex",
            "fileMatch": [
                "Earthfile$"
            ],
            "matchStrings": [
                "\\s*FROM \\s*.*?(?<depName>\\S+):(?<currentValue>[^\\s\\$]+)"
            ],
            "datasourceTemplate": "docker",
            "versioningTemplate": "docker"
        }
    ]
}
